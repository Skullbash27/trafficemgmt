import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

public class Grid {
	
	HashMap<char[], TrafficControl> trafficPoints = new HashMap<char[], TrafficControl>();
	
	HashMap<char[], Road> roadMap = new HashMap<char[], Road>();
	
	int[] streetDist;
	int[] avenueDist;
	
	int xAccPos=0, yAccPos=0;
	
	public Grid(int NumberOfStreets, int NumberOfAvenues, 
			int MinBlockSide, int MaxBlockSide) {
		if(NumberOfStreets >= 999 || NumberOfAvenues >= 999) {
			System.out.println("Numbers are outside program capacity");
			return;
		}
		System.out.println("Creating the grid");
		initRoads(NumberOfStreets, NumberOfAvenues, 
				MinBlockSide, MaxBlockSide);
		initIntersections();
	}
	
	private void initRoads(int NumberOfStreets, int NumberOfAvenues, 
			int MinBlockSide, int MaxBlockSide) {
		System.out.println("Initializing roads, entrance and exit points");
		Road tempRoadS, tempRoadA, tempRoad;
		TrafficControl tempPoint;
		char[] roadIDS = new char[4];
		char[] roadIDA = new char[4];
		char[] roadDir = new char[2];
		int accPos = 0;
		streetDist = new int[NumberOfStreets+2];	//distances array for streets
		streetDist[0] = accPos;						//accumulated position for plotting
		for(int i=1; i<=NumberOfStreets; i++) {		//declaring and initializing Streets
			roadIDS = getStreetID(i);
			roadDir[0] = (i%2==0)? 'E':'W';			//even=east, odd=west
			streetDist[i]= (int) (MinBlockSide+(MaxBlockSide-MinBlockSide)*Math.random());
			accPos += streetDist[i];	
			tempRoadS = new Road(roadIDS, roadDir[0], accPos);
			tempRoadS.setRoadType('S');
			roadMap.put(roadIDS, tempRoadS);
		}
		streetDist[NumberOfStreets+1] = (int) (MinBlockSide+(MaxBlockSide-MinBlockSide)*Math.random());
		
		accPos = 0;
		avenueDist = new int[NumberOfAvenues+2];
		avenueDist[0] = accPos;
		for(int i=1; i<=NumberOfAvenues; i++) {		//declaring and initializing Avenues
			roadIDA = getAvenueID(i);
			roadDir[1] = (i%2==0)? 'S':'N';
			avenueDist[i]= (int) (MinBlockSide+(MaxBlockSide-MinBlockSide)*Math.random());
			accPos += avenueDist[i];	
			tempRoadA = new Road(roadIDA, roadDir[1], accPos);
			tempRoadA.setRoadType('A');
			roadMap.put(roadIDA, tempRoadA);
		}
		avenueDist[NumberOfAvenues+1] = (int) (MinBlockSide+(MaxBlockSide-MinBlockSide)*Math.random());
		
		//declaring and initializing street and avenue entrance and exit points
		char[] pointCtrl;
		int[] xy = new int[2];
		for(Map.Entry<char[], Road> entry : roadMap.entrySet()) {
			//declaring and initializing street entrance and exit points 
			tempRoad = entry.getValue();
			if(tempRoad.getType() == 'S') {
				roadIDA = new char[]{'0','0','0','0'};
				roadIDS = Arrays.copyOfRange(tempRoad.getRoadID(), 0, 4);
				roadIDS[0] = '1';		//first char in ID, 1=entrance
				roadDir[0] = tempRoad.getRoadDirection();
				roadDir[1] = roadDir[0];
				if(roadDir[0] == 'E') {
					xy = new int[]{avenueDist[NumberOfAvenues+1], tempRoad.getAccPos()};
					// x=east edge of screen
				} else if(roadDir[0] == 'W') {
					xy = new int[]{0, tempRoad.getAccPos()};
				}
				pointCtrl = new char[]{'E','N'};
				tempPoint = new TrafficControl(tempRoad, null, 
						roadIDS, roadIDA, roadDir, pointCtrl, xy);
				tempRoad.setEntrancePoints(tempPoint);
				trafficPoints.put(tempPoint.getPointID(), tempPoint);
				roadIDS[0] = '2';		//first char in ID, 2=exit
				if(roadDir[0] == 'E') {
					xy = new int[]{avenueDist[NumberOfAvenues+1], tempRoad.getAccPos()};
				} else if(roadDir[0] == 'W') {
					xy = new int[]{0, tempRoad.getAccPos()};
				}
				pointCtrl = new char[]{'E','X'};
				tempPoint = new TrafficControl(tempRoad, null, 
						roadIDS, roadIDA, roadDir, pointCtrl, xy);
				tempRoad.setExitPoints(tempPoint);
				trafficPoints.put(tempPoint.getPointID(), tempPoint);
			} else if(tempRoad.getType() == 'A') {
				//declaring and initializing avenue entrance and exit points
				roadIDA = Arrays.copyOfRange(tempRoad.getRoadID(), 0, 4);
				roadIDA[0] = '1';		//entrance
				roadIDS = new char[]{'0','0','0','0'};
				roadDir[1] = tempRoad.getRoadDirection();
				roadDir[0] = roadDir[1];
				if(roadDir[1] == 'N') {
					xy = new int[]{tempRoad.getAccPos(), 0};
				} else if(roadDir[1] == 'S') {
					xy = new int[]{tempRoad.getAccPos(), streetDist[NumberOfStreets+1]};
					//y=south edge of screen
				}
				pointCtrl = new char[]{'E','N'};
				tempPoint = new TrafficControl(null, tempRoad, roadIDS, roadIDA, roadDir, 
						pointCtrl, xy);
				tempRoad.setEntrancePoints(tempPoint);
				trafficPoints.put(tempPoint.getPointID(), tempPoint);
				roadIDA[0] = '2';
				if(roadDir[1] == 'S') {
					xy = new int[]{tempRoad.getAccPos(), streetDist[NumberOfStreets+1]};
				} else if(roadDir[1] == 'N') {
					xy = new int[]{tempRoad.getAccPos(), 0};
				}
				pointCtrl = new char[]{'E','X'};
				tempPoint = new TrafficControl(null, tempRoad, roadIDS, roadIDA, roadDir, 
						pointCtrl, xy);
				tempRoad.setExitPoints(tempPoint);
				trafficPoints.put(tempPoint.getPointID(), tempPoint);
			}
		}
	}
	
	private void initIntersections() {
		System.out.println("Initializing Intersection points");
		Road tempRoadS, tempRoadA;
		TrafficControl tempPoint;
		char[] roadIDS, roadIDA, roadDir = new char[2];
		int[] xy = new int[2];
		char[] pointCtrl = new char[]{'R','R'};
		for(Map.Entry<char[], Road> entry1 : roadMap.entrySet()) {
			for(Map.Entry<char[], Road> entry2 : roadMap.entrySet()) {
				tempRoadS = entry1.getValue();
				tempRoadA = entry2.getValue();
				if(entry1.getValue().getType() == 'S' && entry2.getValue().getType() == 'A') {
					roadIDS = Arrays.copyOfRange(tempRoadS.getRoadID(), 0, 4);
					roadIDA = Arrays.copyOfRange(tempRoadA.getRoadID(), 0, 4);
					//declaration and initialization of intersection points
					xy[0] = tempRoadA.getAccPos();
					xy[1] = tempRoadS.getAccPos();
					roadDir[0] = tempRoadS.getRoadDirection();
					roadDir[1] = tempRoadA.getRoadDirection();
					tempPoint = new TrafficControl(tempRoadS, tempRoadA, 
							roadIDS, roadIDA, roadDir, pointCtrl, xy);
					trafficPoints.put(tempPoint.getPointID(), tempPoint);
				}
			}
		}
	}
	
	private static char[] getStreetID(int i) {
		char[] roadIDS = getRoadIDFromInt(i);
		roadIDS[0] = '3';	//first char of the road ID 3=street
		return roadIDS;
	}
	private static char[] getAvenueID(int i) {
		char[] roadIDA = getRoadIDFromInt(i);
		roadIDA[0] = '4';
		return roadIDA;
	}
	
	private static char[] getRoadIDFromInt(int i) {
		char[] roadID = new char[4];
		char[] roadNumber = String.valueOf(i).toCharArray();
		int k=0;
		for(int j=0; j<(3-roadNumber.length); j++) {	//zero pending to hundreds and tens position
			roadID[j+1]='0';
			k++;
		}
		for(int j=k; j<3; j++)
			roadID[j+1]=roadNumber[j-k];
		return roadID;
	}
}
